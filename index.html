<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bouw Subsidie Kompas – Quickscan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
      /* =============================================
         CONFIG – Vul SUBMIT_URL in om inzendingen op te slaan.
         Voorbeelden:
         - Formspree:  https://formspree.io/f/xxxxxxxx
         - Eigen webhook/API: jouw endpoint dat JSON accepteert
         Laat leeg ("") om alleen lokaal te bewaren en geen netwerkverzoek te doen.
      ============================================== */
      const SUBMIT_URL = = "https://formspree.io/f/xeorzdzp";

      const { useMemo, useState } = React;

      function QuickscanApp() {
        const [step, setStep] = useState(1);
        const [submitting, setSubmitting] = useState(false);
        const [showResult, setShowResult] = useState(false);
        const [submitStatus, setSubmitStatus] = useState(null); // 'ok' | 'error' | 'skipped'

        const [form, setForm] = useState({
          // Stap 1 (persoons-/bedrijfsgegevens)
          naam: "", bedrijfsnaam: "", email: "", telefoon: "", adres: "",
          fte: "", sector: "", isMkb: "",
          // Stap 2 (energie & installaties)
          warmtepomp: "", zonnepanelen: "", andereInstallaties: "", verlichting: "",
          // Stap 3 (milieu & materieel)
          circulaireMaterialen: "", elektrischeMachines: "", retrofit: "", laadinfrastructuur: "",
          // Stap 4 (personeel)
          opleidingPlannen: "", heeftOpleidingsplan: "", aantalMedewerkers: "",
          // Stap 5 (project)
          omschrijving: "", startmoment: "", eerdereSubsidie: "", eerdereSubsidieToelichting: "",
        });

        const update = (field, value) => setForm((f) => ({ ...f, [field]: value }));
        const steps = [1,2,3,4,5];

        const stepValid = useMemo(() => {
          switch (step) {
            case 1:
              return (form.naam && form.bedrijfsnaam && form.email && form.sector && form.isMkb);
            case 2:
              return (form.warmtepomp !== "" && form.zonnepanelen !== "" && form.verlichting !== "");
            case 3:
              return (form.circulaireMaterialen !== "" && form.elektrischeMachines !== "" && form.retrofit !== "" && form.laadinfrastructuur !== "");
            case 4:
              return (form.opleidingPlannen !== "" && form.heeftOpleidingsplan !== "");
            case 5:
              return !!form.omschrijving;
            default:
              return true;
          }
        }, [step, form]);

        const result = useMemo(() => computeResults(form), [form]);

        const next = () => setStep((s) => Math.min(steps.length, s + 1));
        const prev = () => setStep((s) => Math.max(1, s - 1));

        const handleSubmit = async (e) => {
          e.preventDefault();
          if (!stepValid) return;
          if (step < steps.length) { next(); return; }

          setSubmitting(true);
          // 1) Altijd lokaal opslaan (in de browser) als extra back-up
          try {
            const all = JSON.parse(localStorage.getItem('quickscan_inzendingen') || '[]');
            all.push({ ts: new Date().toISOString(), form, result });
            localStorage.setItem('quickscan_inzendingen', JSON.stringify(all));
          } catch {}

          // 2) Naar externe endpoint sturen (indien ingesteld)
          try {
            const ok = await sendSubmission({ form, result });
            setSubmitStatus(ok === null ? 'skipped' : (ok ? 'ok' : 'error'));
          } catch {
            setSubmitStatus('error');
          }

          setSubmitting(false);
          setShowResult(true);
          window.scrollTo({ top: 0, behavior: "smooth" });
        };

        return (
          <div className="min-h-screen">
            <header className="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-gray-200">
              <div className="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="h-9 w-9 rounded-2xl bg-emerald-600" />
                  <div>
                    <h1 className="text-lg font-semibold">Bouw Subsidie Kompas</h1>
                    <p className="text-sm text-gray-500 -mt-0.5">Quickscan – vrijblijvend &amp; snel</p>
                  </div>
                </div>
                <Progress current={step} total={steps.length} />
              </div>
            </header>

            <main className="max-w-4xl mx-auto px-4 py-8">
              {!showResult ? (
                <form onSubmit={handleSubmit} className="space-y-6">
                  <Card title={`Stap ${step} van ${steps.length}`} subtitle={stepSubtitle(step)}>
                    {step === 1 && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <Text label="Naam" value={form.naam} onChange={(v) => update('naam', v)} required />
                        <Text label="Bedrijfsnaam" value={form.bedrijfsnaam} onChange={(v) => update('bedrijfsnaam', v)} required />
                        <Text label="E-mailadres" type="email" value={form.email} onChange={(v) => update('email', v)} required />
                        <Text label="Telefoonnummer" value={form.telefoon} onChange={(v) => update('telefoon', v)} />
                        <Text label="Adres bedrijf" value={form.adres} onChange={(v) => update('adres', v)} />
                        <Select label="Aantal medewerkers (FTE)" value={form.fte} onChange={(v) => update('fte', v)} options={['1–10','11–50','>50']} />
                        <Text label="Sector / hoofdactiviteit" value={form.sector} onChange={(v) => update('sector', v)} required />
                        <Radio label="Is uw bedrijf MKB? (EU-definitie)" value={form.isMkb} onChange={(v) => update('isMkb', v)} options={['Ja','Nee']} required />
                      </div>
                    )}

                    {step === 2 && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <Radio label="Gaat u bij (ver)bouw investeren in een warmtepomp?" value={form.warmtepomp} onChange={(v) => update('warmtepomp', v)} options={['Ja','Nee','Weet ik niet']} required />
                        <Radio label="Gaat u zonnepanelen plaatsen?" value={form.zonnepanelen} onChange={(v) => update('zonnepanelen', v)} options={['Ja','Nee','Weet ik niet']} required />
                        <Radio label="Bent u van plan energiezuinige verlichting te installeren of te vervangen?" value={form.verlichting} onChange={(v) => update('verlichting', v)} options={['Ja','Nee','Weet ik niet']} required />
                        <TextArea label="Andere duurzame installaties (optioneel)" value={form.andereInstallaties} onChange={(v) => update('andereInstallaties', v)} placeholder="bijv. zonneboiler, energieopslag, laadpalen" />
                      </div>
                    )}

                    {step === 3 && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <Radio label="Gaat u milieuvriendelijke of circulaire materialen toepassen?" value={form.circulaireMaterialen} onChange={(v) => update('circulaireMaterialen', v)} options={['Ja','Nee','Weet ik niet']} required />
                        <Radio label="Overweegt u elektrische of emissiearme machines/voertuigen?" value={form.elektrischeMachines} onChange={(v) => update('elektrischeMachines', v)} options={['Ja','Nee','Weet ik niet']} required />
                        <Radio label="Wilt u bestaand bouwmaterieel aanpassen/retrofitten om schoner te worden?" value={form.retrofit} onChange={(v) => update('retrofit', v)} options={['Ja','Nee','Weet ik niet']} required />
                        <Radio label="Heeft u (plannen voor) laadinfrastructuur voor materieel/voertuigen?" value={form.laadinfrastructuur} onChange={(v) => update('laadinfrastructuur', v)} options={['Ja','Nee','Weet ik niet']} required />
                      </div>
                    )}

                    {step === 4 && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <Radio label="Heeft u plannen om te investeren in opleiding/ontwikkeling van personeel?" value={form.opleidingPlannen} onChange={(v) => update('opleidingPlannen', v)} options={['Ja','Nee']} required />
                        <Radio label="Is er al een opleidings- of ontwikkelplan?" value={form.heeftOpleidingsplan} onChange={(v) => update('heeftOpleidingsplan', v)} options={['Ja','Nee']} required />
                        <Text label="Hoeveel medewerkers zouden meedoen?" value={form.aantalMedewerkers} onChange={(v) => update('aantalMedewerkers', v)} placeholder="bijv. 5" />
                      </div>
                    )}

                    {step === 5 && (
                      <div className="grid grid-cols-1 gap-4">
                        <TextArea label="Beschrijf kort uw geplande investering(en) of project(en)" value={form.omschrijving} onChange={(v) => update('omschrijving', v)} required />
                        <Text label="Wanneer wilt u starten? (indicatie)" value={form.startmoment} onChange={(v) => update('startmoment', v)} placeholder="bijv. Q1 2026" />
                        <Radio label="Heeft u eerder subsidie ontvangen voor soortgelijke projecten?" value={form.eerdereSubsidie} onChange={(v) => update('eerdereSubsidie', v)} options={['Ja','Nee']} />
                        {form.eerdereSubsidie === 'Ja' && (
                          <TextArea label="Toelichting" value={form.eerdereSubsidieToelichting} onChange={(v) => update('eerdereSubsidieToelichting', v)} />
                        )}
                      </div>
                    )}

                    <div className="mt-6 flex items-center justify-between">
                      <div className="text-sm text-gray-500">Velden met * zijn verplicht.</div>
                      <div className="flex gap-2">
                        {step > 1 && (
                          <button type="button" onClick={prev} className="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50">Terug</button>
                        )}
                        <button type="submit" disabled={!stepValid || submitting} className="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50">
                          {step < steps.length ? 'Volgende' : submitting ? 'Bezig…' : 'Toon conclusie'}
                        </button>
                      </div>
                    </div>
                  </Card>
                </form>
              ) : (
                <ResultView form={form} result={result} submitStatus={submitStatus} onReset={() => { setShowResult(false); setStep(1); setSubmitStatus(null); }} />
              )}
            </main>

            <footer className="max-w-4xl mx-auto px-4 pb-10 text-xs text-gray-500">
              © {new Date().getFullYear()} Bouw Subsidie Kompas · Quickscan is indicatief; definitieve (on)geschiktheid wordt vastgesteld in het adviesgesprek en op basis van actuele regelingen. Inzendingen worden lokaal opgeslagen en optioneel naar een externe endpoint verstuurd.
            </footer>
          </div>
        );
      }

      function stepSubtitle(step) {
        switch (step) {
          case 1: return "Persoons- en bedrijfsgegevens";
          case 2: return "Energie & installaties";
          case 3: return "Milieu & materialen / materieel";
          case 4: return "Personeel & ontwikkeling";
          case 5: return "Projectomschrijving & planning";
          default: return "";
        }
      }

      function Card({ title, subtitle, children }) {
        return (
          <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-5">
            <div className="mb-4">
              <h2 className="text-xl font-semibold">{title}</h2>
              {subtitle && <p className="text-sm text-gray-500 mt-1">{subtitle}</p>}
            </div>
            {children}
          </div>
        );
      }

      function Text({ label, value, onChange, placeholder, type = "text", required }) {
        return (
          <div>
            <label className="block text-sm font-medium text-gray-700">
              {label}{required && <span className="text-rose-600"> *</span>}
            </label>
            <input type={type} className="mt-1 w-full rounded-xl border border-gray-300 bg-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500" value={value} placeholder={placeholder} onChange={(e) => onChange(e.target.value)} />
          </div>
        );
      }

      function TextArea({ label, value, onChange, placeholder, required }) {
        return (
          <div>
            <label className="block text-sm font-medium text-gray-700">
              {label}{required && <span className="text-rose-600"> *</span>}
            </label>
            <textarea className="mt-1 w-full rounded-xl border border-gray-300 bg-white px-3 py-2 h-28 focus:outline-none focus:ring-2 focus:ring-emerald-500" value={value} placeholder={placeholder} onChange={(e) => onChange(e.target.value)} />
          </div>
        );
      }

      function Radio({ label, value, onChange, options = [], required }) {
        return (
          <div>
            <span className="block text-sm font-medium text-gray-700">
              {label}{required && <span className="text-rose-600"> *</span>}
            </span>
            <div className="mt-2 flex flex-wrap gap-2">
              {options.map((opt) => (
                <button key={opt} type="button" onClick={() => onChange(opt)} className={"px-3 py-1.5 rounded-xl border text-sm " + (value === opt ? "border-emerald-600 bg-emerald-50 text-emerald-700" : "border-gray-300 bg-white hover:bg-gray-50")}>
                  {opt}
                </button>
              ))}
            </div>
          </div>
        );
      }

      function Select({ label, value, onChange, options = [] }) {
        return (
          <div>
            <label className="block text-sm font-medium text-gray-700">{label}</label>
            <select className="mt-1 w-full rounded-xl border border-gray-300 bg-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500" value={value} onChange={(e) => onChange(e.target.value)}>
              <option value="">Maak een keuze…</option>
              {options.map((o) => (<option key={o} value={o}>{o}</option>))}
            </select>
          </div>
        );
      }

      function Progress({ current, total }) {
        const pct = Math.round((current / total) * 100);
        return (
          <div className="w-40">
            <div className="text-xs text-gray-500 mb-1 text-right">{pct}%</div>
            <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
              <div className="h-full bg-emerald-600" style={{ width: pct + '%' }} />
            </div>
          </div>
        );
      }

      function Pill({ children }) {
        return (
          <span className="inline-block rounded-full border border-emerald-200 bg-emerald-50 text-emerald-700 px-3 py-1 text-xs font-medium">{children}</span>
        );
      }

      function ResultView({ form, result, submitStatus, onReset }) {
        return (
          <div className="space-y-6">
            <Card title="Conclusie" subtitle="Indicatie op basis van uw antwoorden (geen rechten ontleend)">
              {submitStatus && (
                <div className={(submitStatus === 'ok' ? 'bg-emerald-50 text-emerald-800 border-emerald-200' : submitStatus === 'skipped' ? 'bg-amber-50 text-amber-800 border-amber-200' : 'bg-rose-50 text-rose-800 border-rose-200') + ' border rounded-xl p-3 mb-4 text-sm'}>
                  {submitStatus === 'ok' && 'Inzending ontvangen. We nemen indien nodig contact op.'}
                  {submitStatus === 'skipped' && 'Inzending lokaal opgeslagen. Externe opslag is niet geconfigureerd.'}
                  {submitStatus === 'error' && 'Inzending kon niet worden verstuurd. Probeer later opnieuw of neem contact op.'}
                </div>
              )}

              {result.suggesties.length > 0 ? (
                <div className="space-y-4">
                  <p className="text-gray-700">Op basis van uw plannen maakt u mogelijk kans op de onderstaande regelingen. In een adviesgesprek controleren wij de voorwaarden en stellen we de optimale route voor.</p>
                  <div className="flex flex-wrap gap-2">
                    {result.suggesties.map((s) => (<Pill key={s.code}>{s.naam}</Pill>))}
                  </div>
                  <div className="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
                    {result.toelichting.map((t, i) => (
                      <div key={i} className="rounded-xl border border-gray-200 p-3 bg-white">
                        <div className="text-sm font-semibold">Waarom dit past</div>
                        <div className="text-sm text-gray-700 mt-1">{t}</div>
                      </div>
                    ))}
                  </div>
                </div>
              ) : (
                <div className="text-gray-700">Op basis van de huidige antwoorden zien we geen directe match met de bekende regelingen. Tijdens een gesprek bekijken we alternatieven of ontbrekende informatie.</div>
              )}
              <div className="mt-6 flex flex-wrap gap-2">
                <button onClick={() => window.print()} className="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50">Print/PDF</button>
                <button onClick={onReset} className="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Nieuwe quickscan</button>
              </div>
            </Card>

            <Card title="Samenvatting van uw input">
              <div className="text-sm grid grid-cols-1 md:grid-cols-2 gap-3">
                <SummaryRow k="Naam" v={form.naam} />
                <SummaryRow k="Bedrijfsnaam" v={form.bedrijfsnaam} />
                <SummaryRow k="Sector" v={form.sector} />
                <SummaryRow k="MKB" v={form.isMkb} />
                <SummaryRow k="Warmtepomp" v={form.warmtepomp} />
                <SummaryRow k="Zonnepanelen" v={form.zonnepanelen} />
                <SummaryRow k="Verlichting (energiezuinig)" v={form.verlichting} />
                <SummaryRow k="Circulaire materialen" v={form.circulaireMaterialen} />
                <SummaryRow k="Elektrische/emissiearme machines" v={form.elektrischeMachines} />
                <SummaryRow k="Retrofit materieel" v={form.retrofit} />
                <SummaryRow k="Laadinfrastructuur" v={form.laadinfrastructuur} />
                <SummaryRow k="Opleiding/ontwikkeling" v={form.opleidingPlannen} />
                <SummaryRow k="Aantal medewerkers" v={form.aantalMedewerkers} />
                <SummaryRow k="Startmoment" v={form.startmoment} />
              </div>
            </Card>

            <Card title="Vervolg" subtitle="Wij helpen met controle en aanvraag">
              <ul className="list-disc pl-5 text-gray-700 space-y-2 text-sm">
                <li>Controle van technische specificaties en actuele voorwaarden.</li>
                <li>Check op combinaties van regelingen en fiscale optimalisatie.</li>
                <li>Benodigde documentenlijst en planning voor de aanvraag.</li>
              </ul>
            </Card>
          </div>
        );
      }

      function SummaryRow({ k, v }) {
        return (
          <div className="flex items-center justify-between gap-3 border-b border-dashed border-gray-200 py-1">
            <span className="text-gray-500">{k}</span>
            <span className="font-medium">{v || "—"}</span>
          </div>
        );
      }

      function computeResults(f) {
        const suggesties = [];
        const toelichting = [];
        const ja = (x) => (x || "").toLowerCase() === "ja";
        const misschien = (x) => (x || "").toLowerCase() === "weet ik niet";
        const inBouw = (f.sector || "").toLowerCase().includes("bouw");
        const isMkb = (f.isMkb || "").toLowerCase() === "ja";

        if (ja(f.warmtepomp) || (f.andereInstallaties || "").toLowerCase().includes("zonneboiler")) {
          suggesties.push({ code: "ISDE", naam: "ISDE – Investeringssubsidie Duurzame Energie" });
          toelichting.push("Plannen voor duurzame warmte (bijv. warmtepomp/zonneboiler) komen vaak in aanmerking.");
        }
        if (ja(f.verlichting) || ja(f.zonnepanelen) || (f.andereInstallaties || "").length > 3) {
          suggesties.push({ code: "EIA", naam: "EIA – Energie-investeringsaftrek" });
          toelichting.push("Energiezuinige investeringen (zoals verlichting of energie-opwek/ -besparing) kunnen fiscaal voordelig zijn.");
        }
        if (ja(f.circulaireMaterialen) || ja(f.elektrischeMachines) || ja(f.retrofit)) {
          suggesties.push({ code: "MIA/Vamil", naam: "MIA/Vamil – Milieu-investeringsaftrek & versnelde afschrijving" });
          toelichting.push("Milieuvriendelijke bedrijfsmiddelen of aanpassingen kunnen onder MIA/Vamil vallen.");
        }
        if (inBouw && (ja(f.elektrischeMachines) || ja(f.retrofit) || ja(f.laadinfrastructuur))) {
          suggesties.push({ code: "SSEB", naam: "SSEB – Schoon en Emissieloos Bouwmaterieel" });
          toelichting.push("Voor bouwbedrijven met emissieloos materieel/retrofit of laadinfrastructuur is vaak SSEB relevant.");
        }
        if (isMkb && ja(f.opleidingPlannen)) {
          suggesties.push({ code: "SLIM", naam: "SLIM – Leren & Ontwikkelen in het MKB" });
          toelichting.push("Voor MKB-bedrijven die investeren in leren & ontwikkelen is er vaak SLIM-ondersteuning.");
        }

        const unique = [];
        const seen = new Set();
        for (const s of suggesties) {
          if (!seen.has(s.code)) { unique.push(s); seen.add(s.code); }
        }

        const onzeker = [f.warmtepomp, f.zonnepanelen, f.verlichting, f.circulaireMaterialen, f.elektrischeMachines, f.retrofit, f.laadinfrastructuur].some(misschien);
        if (onzeker) { toelichting.push("Bij enkele antwoorden is nog onzekerheid. We controleren dit graag in een kosteloos adviesgesprek."); }

        return { suggesties: unique, toelichting };
      }

      async function sendSubmission(payload) {
        if (!SUBMIT_URL) return null; // geen externe opslag geconfigureerd
        const res = await fetch(SUBMIT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            ...payload,
            _subject: 'Quickscan inzending',
          }),
        });
        return res.ok;
      }

      ReactDOM.render(<QuickscanApp />, document.getElementById('root'));
    </script>
  </body>
</html>
